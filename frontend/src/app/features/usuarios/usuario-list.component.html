<!-- Header compacto -->
<div class="list-header">
  <h1>Usuarios</h1>
  <button mat-mini-fab color="primary" (click)="openForm()" class="fab-add">
    <mat-icon>add</mat-icon>
  </button>
</div>

<!-- Busca -->
<div class="list-search">
  <mat-form-field appearance="outline" class="search-field">
    <mat-icon matPrefix>search</mat-icon>
    <input matInput [ngModel]="searchTerm()" (ngModelChange)="onSearchChange($event)" placeholder="Buscar por nome ou email..." />
  </mat-form-field>
</div>

<!-- Filtro por papel -->
<div class="status-chips">
  <mat-chip-listbox [value]="filtroPapel()" (change)="onPapelChange($event.value || '')">
    <mat-chip-option value="">Todos</mat-chip-option>
    <mat-chip-option value="ADMIN">Administrador</mat-chip-option>
    <mat-chip-option value="ATENDENTE">Atendente</mat-chip-option>
  </mat-chip-listbox>
</div>

@if (loading()) {
  <div class="loading">
    <mat-spinner diameter="40"></mat-spinner>
  </div>
} @else {
  <!-- Desktop: Table view -->
  <div class="table-container hide-mobile">
    <table mat-table [dataSource]="usuarios()">
      <ng-container matColumnDef="nome">
        <th mat-header-cell *matHeaderCellDef>Nome</th>
        <td mat-cell *matCellDef="let usuario">{{ usuario.nome }}</td>
      </ng-container>

      <ng-container matColumnDef="email">
        <th mat-header-cell *matHeaderCellDef>Email</th>
        <td mat-cell *matCellDef="let usuario">{{ usuario.email }}</td>
      </ng-container>

      <ng-container matColumnDef="papel">
        <th mat-header-cell *matHeaderCellDef>Papel</th>
        <td mat-cell *matCellDef="let usuario">
          <mat-chip [color]="usuario.papel === 'ADMIN' ? 'warn' : 'primary'" selected>
            {{ usuario.papel === 'ADMIN' ? 'Administrador' : 'Atendente' }}
          </mat-chip>
        </td>
      </ng-container>

      <ng-container matColumnDef="ativo">
        <th mat-header-cell *matHeaderCellDef>Ativo</th>
        <td mat-cell *matCellDef="let usuario">
          <mat-icon [class]="usuario.ativo ? 'active' : 'inactive'">
            {{ usuario.ativo ? 'check_circle' : 'cancel' }}
          </mat-icon>
        </td>
      </ng-container>

      <ng-container matColumnDef="acoes">
        <th mat-header-cell *matHeaderCellDef>Acoes</th>
        <td mat-cell *matCellDef="let usuario">
          <button mat-icon-button color="primary" matTooltip="Editar" (click)="openForm(usuario)">
            <mat-icon>edit</mat-icon>
          </button>
          <button mat-icon-button color="warn" matTooltip="Excluir" (click)="confirmDelete(usuario)">
            <mat-icon>delete</mat-icon>
          </button>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
    </table>
  </div>

  <!-- Mobile: Lista compacta -->
  <div class="compact-list">
    @for (usuario of usuarios(); track usuario.id) {
      <div class="compact-card" [class.inativo]="!usuario.ativo">
        <div class="compact-main" (click)="openForm(usuario)">
          <div class="compact-info">
            <span class="compact-title">{{ usuario.nome }}</span>
            <span class="compact-subtitle">{{ usuario.email }}</span>
          </div>
          <div class="compact-meta">
            <span class="compact-tag" [class.admin]="usuario.papel === 'ADMIN'">
              {{ usuario.papel === 'ADMIN' ? 'Admin' : 'Atend.' }}
            </span>
          </div>
        </div>
        <div class="compact-actions">
          <button mat-icon-button (click)="openForm(usuario); $event.stopPropagation()">
            <mat-icon>edit</mat-icon>
          </button>
          <button mat-icon-button class="delete-btn" (click)="confirmDelete(usuario); $event.stopPropagation()">
            <mat-icon>delete_outline</mat-icon>
          </button>
        </div>
      </div>
    }
  </div>

  @if (usuarios().length === 0) {
    <div class="empty-message">
      <mat-icon>admin_panel_settings</mat-icon>
      <h3>Nenhum usuario encontrado</h3>
      <p>Adicione um novo usuario para comecar</p>
    </div>
  }
}
